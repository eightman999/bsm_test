#現在のスコープの領有する鉱山のレベルの合計を算出します。
culc_mine_total = {
	hidden_effect = {
		#金鉱山
		set_variable = { MD_gold = 0 }
		#領有済
		every_owned_state = {
			limit = { check_variable = { THIS.gold_mine > 0 } }
			add_to_variable = { ROOT.MD_gold = THIS.gold_mine }
		}
		#占領済み
		every_controlled_state = {
			limit = { check_variable = { THIS.gold_mine > 0 } is_in_array = { occupied_mine_state = THIS } }
			add_to_variable = { ROOT.MD_gold = THIS.gold_mine }
		}

	}
}


#指定のステートの金鉱山のレベルを既定の量変化させる(temp state_id / level)
add_gold_mine_level = {
	if = {
		limit = {
			has_variable = state_id
			has_variable = level
		}
		custom_effect_tooltip = tt_add_gold_mine_level
		var:state_id = { add_to_variable = { gold_mine = level } }
		culc_mine_total = yes
	}
}

mine_on_monthly = {
	culc_mine_total = yes

	# log = "[?MD_gold]/[?MD_jewel]"
	#現状の設定（仮置き）
	#金鉱山のコスト＝総レベル×2
	#金鉱山の収入＝総レベル×2.5 × (国際緊張度+1)

	set_temp_variable = { temp_MD_gold_cost = MD_gold }
	multiply_temp_variable = { temp_MD_gold_cost = 2 } #適当に2倍
	set_variable = { MD_cost = temp_MD_gold_cost }
	# log = "gold cost :[?temp_MD_gold_cost]"

	set_temp_variable = { temp_MD_gold_gain = MD_gold }
	multiply_temp_variable = { temp_MD_gold_gain = 2.5 } #総レベル×2.5
	set_temp_variable = { temp_threat = global.threat } #国際緊張度
	add_to_temp_variable = { temp_threat = 1 } #国際緊張度+1
	multiply_temp_variable = { temp_MD_gold_gain = temp_threat } #総レベル×2.5 × (国際緊張度+1)
	set_variable = { MD_gain = temp_MD_gold_gain }
	# log = "gold gain :[?temp_MD_gold_gain]"

	#実際に足したり引いたり泣いたり笑ったり
	subtract_from_variable = { Unified_Currency = MD_cost } #通貨からコストを引く
	add_to_variable = { Unified_Currency = MD_gain } #通貨から収入を足す
	#( ;∀;)
}
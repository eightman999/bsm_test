#初期設定
mine_first_setting = {
	clear_array = bsm_mine_log_id
	clear_array = bsm_mine_log_value_1
	clear_array = bsm_mine_log_value_2
	clear_array = bsm_mine_log_value_3
}
#現在のスコープの領有する鉱山のレベルの合計を算出します。
calc_mine_total = {
	hidden_effect = {
		#金鉱山
		set_variable = { MD_mine_size = 0 }
		#領有済
		every_owned_state = {
			limit = { check_variable = { THIS.gold_mine > 0 } }
			add_to_variable = { ROOT.MD_mine_size = THIS.gold_mine }
		}
		#占領済み
		every_controlled_state = {
			limit = { check_variable = { THIS.gold_mine > 0 } is_in_array = { occupied_mine_state = THIS } }
			add_to_variable = { ROOT.MD_mine_size = THIS.gold_mine }
		}

	}
}


#指定のステートの金鉱山のレベルを既定の量変化させる(temp state_id / level)
add_gold_mine_level = {
	if = {
		limit = {
			has_variable = state_id
			has_variable = level
		}
		custom_effect_tooltip = tt_add_gold_mine_level
		var:state_id = { add_to_variable = { gold_mine = level } }
		calc_mine_total = yes
		#ログ
		add_to_array = { bsm_mine_log_id = 1 }
		add_to_array = { bsm_mine_log_value_1 = state_id }
		add_to_array = { bsm_mine_log_value_2 = level }
		add_to_array = { bsm_mine_log_value_3 = 0 } #使わない

	}
}
#金需要を変化させる demand_value 
change_gold_demand = {
	if = {
		limit = {
			has_variable = demand_value
		}
		custom_effect_tooltip = tt_change_gold_demand
		add_to_variable = { global.MD_demand = demand_value }	
		#ログ
		every_country = {
			add_to_array = { bsm_mine_log_id = 2 } #金需要の変化
			add_to_array = { bsm_mine_log_value_1 = 1 } #要因
			add_to_array = { bsm_mine_log_value_2 = demand_value }
			add_to_array = { bsm_mine_log_value_3 = 0 } #使わない
		}


	}


}

mine_on_monthly = {
	calc_mine_total = yes

	# log = "[?MD_mine_size]/[?MD_jewel]"
	#現状の設定（仮置き）
	#金鉱山のコスト＝総レベル×2
	#金鉱山の収入＝総レベル×2.5 × (国際緊張度+1)

	set_temp_variable = { temp_MD_mine_cost = MD_mine_size }
	multiply_temp_variable = { temp_MD_mine_cost = 2 } #適当に2倍
	set_variable = { MD_cost = temp_MD_mine_cost }
	# log = "gold cost :[?temp_MD_mine_cost]"

	set_temp_variable = { temp_MD_mine_size_gain = MD_mine_size }
	multiply_temp_variable = { temp_MD_mine_size_gain = 2.5 } #総レベル×2.5
	set_temp_variable = { temp_threat = global.threat } #国際緊張度
	add_to_temp_variable = { temp_threat = 1 } #国際緊張度+1
	multiply_temp_variable = { temp_MD_mine_size_gain = temp_threat } #総レベル×2.5 × (国際緊張度+1)
	set_variable = { MD_total = temp_MD_mine_size_gain }
	# log = "gold gain :[?temp_MD_mine_size_gain]"

	#実際に足したり引いたり泣いたり笑ったり
	subtract_from_variable = { Unified_Currency = MD_cost } #通貨からコストを引く
	add_to_variable = { Unified_Currency = MD_total } #通貨から収入を足す
	#( ;∀;)
}
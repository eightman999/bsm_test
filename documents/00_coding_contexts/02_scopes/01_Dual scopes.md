## Dual scopes

The following scopes can be used either as effect or trigger scopes; some can also be used as the right side of some effects and triggers as a target. If usage as a target is possible, it's marked within the table.
Several dual scopes may have a scope that varies depending on where it's used, such as variables, which can be set to anything.

### Dual scopes:

| Name | Usage | Target type | Example | Description | Usable as target | Version Added |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **TAG** | Always usable | Country scope | `SOV = { country_event = my_event.1 }` | The country defined by the tag or tag alias. Tag aliases are defined in `/Hearts of Iron IV/common/country_tag_aliases`, as a way to refer to a specific country (such as a side in a civil war) in addition to its actual tag. If the country with the exact tag doesn't exist, but a dynamic country originating from the specified tag does, the scope will refer to the dynamic country. | ✓ | 1.0 |
| **<state_id>** | Always usable | State scope | `123 = { transfer_state_to = SCO }` | The state defined by this id. | ✓ | 1.0 |
| **<character>** | not within Character scope | Character scope | `ENG_theodore_makhno = { set_nationality = UKR }` | On game versions prior to 1.12.8, the character must be already recruited by the country this is scoped from. | ✓ | 1.11 |
| **mio:<MIO>** | Within country scope only | MIO scope | `mio:AST_cockatoo_doe_organization = { … }` | The MIO identified by that ID as defined within the `/Hearts of Iron IV/common/military_industrial_organization/organizations/*.txt` file. | ✓ | 1.13 |
| **sp:<special_project>** | Within country scope only | Special project scope | `sp:sp_land_flamethrower_tank = { … }` | The special project identified by that ID as defined within the `/Hearts of Iron IV/common/special_projects/projects/*.txt` file. | ✓ | 1.15 |
| **ROOT** | Always usable | Depends on usage | `ENG = { FRA = { GER = { declare_war_on = { target = ROOT type = annex_everything } } } } #GER declares war on ENG (if there is no scope before ENG)` | Targets the root node of the block, an inherent property of each block. Most commonly, this is the default scope: for example, `ROOT` within a national focus will always refer to the country doing the focus and `ROOT` within a event will always refer to the country getting the event. However, some blocks do distinguish between the default scope and ROOT, such as certain scripted GUI contexts or certain on actions. If a block doesn't have `ROOT` defined (such as `on_startup` in on actions), then it is impossible to use it. | ✓ | 1.0 |
| **THIS** | Always usable | Depends on usage | `set_temp_variable = { target_country = THIS }` | Targets the current scope where it's used. For example, when used in `every_state`, it will refer to the state that's currently being evaluated. Primarily useful for variables (as in the example, where omitting it wouldn't work) or for built-in localisation commands, where some scope must be specified. More rarely, this may help with scope manipulation when using `PREV`. Since omitting it makes no difference in how the code gets interpreted, there is little to no usage outside of these cases. | ✓ | 1.0 |
| **PREV** | Always usable | Depends on usage | `FRA = { random_country = { GER = { declare_war_on = { target = PREV type = annex_everything } } } } #Germany declares war on random_country` | Targets the scope that the current scope is contained in. Can have additional applications where the assumed default scope differs from the ROOT, such as in state events or some on_actions. Can be chained indefinitely as `PREV.PREV`. Commonly results in broken-looking tooltips: what's shown to the player doesn't always correlate with reality. See also: PREV usage. | ✓ | 1.0 |
| **FROM** | Always usable | Depends on usage | `declare_war_on = { target = FROM type = annex_everything }`<br><br>`FROM = { load_oob = defend_ourselves }` | Can be chained indefinitely as `FROM.FROM`. Used to target various hardcoded scopes inherent to the block, often a secondary scope in addition to ROOT. For example: In events, this refers to the country that sent the event (i.e. if the event was fired using an effect, then it's the ROOT scope where it was fired). In targeted decisions or diplomacy scripted triggers, this refers to the scope that is targeted. | ✓ | 1.0 |
| **overlord** | Within country scope only | Country scope | `overlord = { … }` | The overlord of the country if it is a subject. Subject to the 'invalid event target' error. | X | 1.3 |
| **faction_leader** | Within country scope only | Country scope | `faction_leader = { add_to_faction = FROM }` | Faction leader of the faction the country is a part of. Subject to the 'invalid event target' error. | X | 1.10.1 |
| **owner** | Within state, character, or combatant scope only | Country scope | `owner = { add_ideas = owns_this_state }` | In state scope, the country that owns the state. In combatant scope, the country that owns the divisions. In character scope, the country that has recruited the character. Subject to the 'invalid event target' error when used for a state. | X | 1.0 |
| **controller** | Within state scope only | Country scope | `controller = { ROOT = { create_wargoal = { target = PREV type = take_state_focus generator = { 123 } } } }` | The controller of the current state. Subject to the 'invalid event target' error. | X | 1.0 |
| **capital_scope** | Within country scope only | State scope | `capital_scope = { … }` | The state where the capital of the current country is located in. Subject to the 'invalid event target' error in rare cases. | X | 1.0 |
| **event_target:<br>&lt;event_target_key&gt;** | Always usable | Depends on usage | `event_target:my_event_target = { … }` | Saved event target or global event target, with no space after the colon. Subject to the 'invalid event target' error. | ✓ | 1.0 |
| **var:<variable>** | Always usable | Depends on usage | `var:my_variable = { … }`<br>`add_to_faction = my_variable` or<br>`add_to_faction = var:my_variable` | Variable set to a scope. When used as a target rather than a scope, the `var:` can be omitted in most cases. | ✓ | 1.5 |

### Invalid event target
See also: Event targets

In regards to some dual scopes, a possible logged error to get while using them is "Invalid event target", as in `common/national_focus/generic.txt:690: controller: invalid event target: controller`, while the scope being used is not necessarily an event target.

This refers to the scope not having any defined target in the context that it is used, i.e. it is impossible to select any single target when it is used. In case of `controller = { ... }` as in the example, this means that the scope is checked or executed in a state that isn't controlled by any country. Such states are rather unstable and can cause crashes easily (such as if evaluated for an air mission by AI or if doing almost any effect on them), so if this happens for `controller` or `owner`, then this must be fixed only by making sure that every state has an owner or controller.

In practice, this gets skipped over entirely when evaluating the effects or triggers: none of the effects would be executed; as a trigger it'll not come up as either true or false. However, since this can be checked every tick, leaving it as is can result in cluttering the error log. To avoid this, it's possible to use the if statement in effects or triggers in such a manner that the dual scope would only be checked if the conditions for it existing are fulfilled, such as by checking that the country is indeed a subject before checking the overlord. An example of that being done is as such: